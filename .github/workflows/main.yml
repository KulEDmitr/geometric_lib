name: Laba5
on: push
jobs:
  ubuntu-tests:
    runs-on: ubuntu-24.04
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          ref: new_features_466737
          fetch-depth: 0

      - name: ubuntu
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential g++ libstdc++6
          chmod +x ./build/tests/tests
          ./build/tests/tests

  build-windows:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          ref: new_features_466737
          fetch-depth: 0

      - name: Setup MSBuild
        run: |
          choco install microsoft-build-from-source --pre

      - name: Build project
        run: msbuild /t:Build /p:Configuration=Release /p:Platform=x64

      - name: Copy artifacts
        run: |
          xcopy /Y /S $(Build.ArtifactStagingDirectory)\Binaries\* $(ArtifactStagingDirectory)\
          xcopy /Y /S *.* $(Build.StagingDirectory)\

      - name: Publish artifacts
        run: |
          dotnet tool install -g DotNetCore.Cli --version 2.1.500

      - name: Upload Artifacts
        run: |
          dotnet tool dotnet pack -c Release -o win-x64.zip --included-runtimes win10-x64

      - name: Publish artifact
        uses: actions/upload-artifact@v3
        with:
          name: Win-x64
          path: win-x64.zip

  test-windows:
    needs: build-windows
    runs-on: windows-latest
    
    steps:
    - name: windows
      run: |
        & '.\\build\\tests\\tests.exe'


        
